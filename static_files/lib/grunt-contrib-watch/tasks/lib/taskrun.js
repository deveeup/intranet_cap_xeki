"use strict";var path=require("path"),EE=require("events").EventEmitter,util=require("util");module.exports=function(t){function s(t){this.name=t.name||0,this.files=t.files||[],this.tasks=t.tasks||[],this.options=t.options,this.startedAt=!1,this.spawned=null,this.changedFiles=Object.create(null),"string"==typeof this.tasks&&(this.tasks=[this.tasks])}require("./livereload")(t);return s.prototype.run=function(s){var e=this;if(!1===e.startedAt){if(e.startedAt=Date.now(),e.tasks.length<1)return s();!1===e.options.spawn||!0===e.options.nospawn?(t.task.run(e.tasks),s()):e.spawned=t.util.spawn({grunt:!0,opts:{cwd:e.options.cwd,stdio:"inherit"},args:e.tasks.concat(e.options.cliArgs||[])},function(t,i,n){e.spawned=null,s()})}},s.prototype.complete=function(){var t=Date.now()-this.startedAt;return this.startedAt=!1,this.spawned&&(this.spawned.kill("SIGINT"),this.spawned=null),this.livereload&&this.livereload.trigger(Object.keys(this.changedFiles)),t},s};