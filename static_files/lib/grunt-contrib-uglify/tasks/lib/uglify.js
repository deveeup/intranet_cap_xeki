"use strict";var UglifyJS=require("uglify-js"),fs=require("fs");exports.init=function(e){var r={};r.minify=function(r,o,i){i=i||{},e.verbose.write("Minifying with UglifyJS...");var n=null,a="",t=s(i,o),p=UglifyJS.OutputStream(t);if(r.forEach(function(r){var s=e.file.read(r);void 0!==i.sourceMapPrefix&&(r=r.replace(/^\/+/,"").split(/\/+/).slice(i.sourceMapPrefix).join("/")),a+=s,n=UglifyJS.parse(s,{filename:r,toplevel:n})}),i.wrap&&(n=n.wrap_commonjs(i.wrap,i.exportAll)),i.enclose){var u=e.util._.map(i.enclose,function(e,r){return r+":"+e});n=n.wrap_enclose(u)}if(n.figure_out_scope(),!1!==i.compress){!0!==i.compress.warnings&&(i.compress.warnings=!1);var c=UglifyJS.Compressor(i.compress);(n=n.transform(c)).figure_out_scope()}!1!==i.mangle&&n.mangle_names(i.mangle),n.print(p);var m=p.get();(i.sourceMappingURL||i.sourceMap)&&(m+="\n//# sourceMappingURL="+(i.sourceMappingURL||i.sourceMap));var l={max:a,min:m,sourceMap:t.source_map};return e.verbose.ok(),l};var s=function(r,s){var o={beautify:!1,source_map:null};if(r.preserveComments&&("all"===r.preserveComments||!0===r.preserveComments?o.comments=!0:"some"===r.preserveComments?o.comments=/^!|@preserve|@license|@cc_on/i:e.util._.isFunction(r.preserveComments)&&(o.comments=r.preserveComments)),r.banner&&r.sourceMap&&(o.preamble=r.banner),r.beautify&&(e.util._.isObject(r.beautify)?e.util._.extend(o,r.beautify):o.beautify=!0),r.sourceMap){var i;r.sourceMapIn&&(i=e.file.readJSON(r.sourceMapIn)),o.source_map=UglifyJS.SourceMap({file:s,root:r.sourceMapRoot,orig:i})}return o};return r};